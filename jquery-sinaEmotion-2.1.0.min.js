/*!
 * jQuery Sina Emotion v2.1.0
 * http://www.clanfei.com/
 *
 * Copyright 2012-2014 Lanfei
 * Released under the MIT license
 *
 * Date: 2014-05-19T20:10:23+0800
 */
(function(g){var m;var h;var i;var c;var a=[];var d="默认";var j=function(){g("body").bind({click:function(){g("#sinaEmotion").hide()}});g("#sinaEmotion").bind({click:function(n){n.stopPropagation()}}).delegate(".prev",{click:function(n){var o=g("#sinaEmotion .categories").data("page");e(o-1);n.preventDefault()}}).delegate(".next",{click:function(n){var o=g("#sinaEmotion .categories").data("page");e(o+1);n.preventDefault()}}).delegate(".category",{click:function(n){g("#sinaEmotion .categories .current").removeClass("current");f(g.trim(g(this).addClass("current").text()));n.preventDefault()}}).delegate(".page",{click:function(n){g("#sinaEmotion .pages .current").removeClass("current");var o=parseInt(g(this).addClass("current").text()-1);b(o);n.preventDefault()}}).delegate(".face",{click:function(o){var n=g("#sinaEmotion").hide().data("target");n.insertText(g(this).children("img").prop("alt"));o.preventDefault()}})};var l=function(n){if(h){n&&n();return}if(!m){m=g.fn.sinaEmotion.options}h={};i=[];c={};g("body").append('<div id="sinaEmotion">正在加载，请稍后...</div>');j();g.getJSON("https://api.weibo.com/2/emotions.json?callback=?",{source:m.appKey,language:m.language},function(q){var s,r;var t=q.data;g("#sinaEmotion").html('<div class="right"><a href="#" class="prev">&laquo;</a><a href="#" class="next">&raquo;</a></div><ul class="categories"></ul><ul class="faces"></ul><ul class="pages"></ul>');for(var p=0,o=t.length;p<o;++p){s=t[p];r=s.category||d;if(!h[r]){h[r]=[];i.push(r)}h[r].push({icon:s.icon,phrase:s.phrase});c[s.phrase]=s.icon}g(a).parseEmotion();a=null;n&&n()})};var e=function(t){var q="";var s=i.length;var o=Math.ceil(s/5);var n=g("#sinaEmotion .categories");var r=n.data("category")||d;t=(t+o)%o;for(var p=t*5;p<s&&p<(t+1)*5;++p){q+='<li class="item"><a href="#" class="category'+(r==i[p]?" current":"")+'">'+i[p]+"</a></li>"}n.data("page",t).html(q)};var f=function(n){g("#sinaEmotion .categories").data("category",n);b(0);k()};var b=function(u){var v;var t="";var p="";var w=m.rows;var n=g("#sinaEmotion .categories").data("category");var q=h[n];var o=q.length;u=u||0;for(var s=u*w,r=q.length;s<r&&s<(u+1)*w;++s){v=q[s];t+='<li class="item"><a href="#" class="face"><img class="sina-emotion" src="'+v.icon+'" alt="'+v.phrase+'" /></a></li>'}g("#sinaEmotion .faces").html(t)};var k=function(){var q="";var t=m.rows;var s=g("#sinaEmotion .categories").data("category");var n=h[s];var r=n.length;if(r>t){for(var p=0,o=Math.ceil(r/t);p<o;++p){q+='<li class="item"><a href="#" class="page'+(p==0?" current":"")+'">'+(p+1)+"</a></li>"}g("#sinaEmotion .pages").html(q).show()}else{g("#sinaEmotion .pages").hide()}};g.fn.sinaEmotion=function(n){n=n||function(){return g(this).parents("form").find("textarea,input[type=text]").eq(0)};this.each(function(){var p=g(this);var o;if(typeof n=="function"){o=n.call(this)}else{o=g(n)}p.click(function(q){var r=p.offset();l(function(){f(d);e(0)});g("#sinaEmotion").css({top:r.top+p.outerHeight()+5,left:r.left}).data("target",o).show();return false})});return this};g.fn.parseEmotion=function(){if(!i){a=g(this);l()}else{if(i.length==0){a=a.add(g(this))}else{g(this).each(function(){var o=g(this);var n=o.html();n=n.replace(/<.*?>/g,function(p){p=p.replace("[","&#91;");p=p.replace("]","&#93;");return p}).replace(/\[[^\[\]]*?\]/g,function(p){var q=c[p];if(q){return'<img class="sina-emotion" src="'+q+'" alt="'+p+'" />'}return p});o.html(n)})}}return this};g.fn.insertText=function(n){this.each(function(){if(this.tagName!=="INPUT"&&this.tagName!=="TEXTAREA"){return}if(document.selection){this.focus();var p=document.selection.createRange();p.text=n;p.collapse();p.select()}else{if(this.selectionStart!==undefined){var q=this.selectionStart;var o=this.selectionEnd;this.value=this.value.substring(0,q)+n+this.value.substring(o,this.value.length);this.selectionStart=this.selectionEnd=q+n.length}else{this.value+=n}}});return this};g.fn.sinaEmotion.options={rows:72,language:"cnname",appKey:"1362404091"}})(jQuery);